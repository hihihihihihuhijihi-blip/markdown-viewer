# 医药行业合规话术转换系统 - 设计方案

## 1. 项目概述

### 1.1 项目背景
医药行业在日常营销、学术推广、客户沟通中，存在大量违规话术的风险。本系统通过AI技术自动检测并转换违规话术为合规表达，帮助企业降低合规风险。

### 1.2 核心价值
- **智能检测**：覆盖66+风险术语，支持精确匹配和模糊匹配
- **自动转换**：一键将违规话术转换为合规表达
- **敏感信息保护**：自动检测并脱敏医生姓名等敏感信息
- **多端支持**：Web应用、企业微信/钉钉机器人、浏览器插件、API服务
- **风险分级**：高风险/中风险/低风险三级预警
- **法规依据**：每条风险术语附相关法律法规条款

### 1.3 技术栈

| 层级 | 技术选型 |
|------|----------|
| 前端 | React + Tailwind CSS + shadcn/ui |
| 后端 | FastAPI (Python) |
| 核心引擎 | Claude Opus 4.5 / Sonnet 4.5 / Gemini 2.5 Pro |
| 数据库 | PostgreSQL + Redis |
| 向量数据库 | Pinecone Cloud |
| 部署 | AWS / 阿里云 |

---

## 2. 系统架构

### 2.1 整体架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                          用户访问层                               │
├──────────────┬──────────────┬──────────────┬────────────────────┤
│   Web 应用   │ 企业微信/钉钉 │ 浏览器插件   │     API 服务        │
└──────┬───────┴──────┬───────┴──────┬───────┴──────────┬────────┘
       │              │              │                  │
       └──────────────┴──────────────┴──────────────────┘
                             │
                    ┌────────▼────────┐
                    │   API 网关层     │
                    │   (FastAPI)     │
                    └────────┬────────┘
                             │
       ┌─────────────────────┼─────────────────────┐
       │                     │                     │
┌──────▼──────┐    ┌────────▼────────┐    ┌───────▼────────┐
│  规则引擎   │    │   LLM 路由层     │    │  敏感信息检测   │
│  (术语库)   │    │  (Claude/Gemini) │    │  (姓名脱敏)     │
└─────────────┘    └────────┬────────┘    └────────────────┘
                            │
                   ┌────────▼────────┐
                   │   向量检索      │
                   │  (Pinecone)     │
                   └─────────────────┘
```

### 2.2 核心模块

#### 2.2.1 合规检测模块 (detector.py)
- 术语库管理：66条风险术语
- 精确匹配与模糊匹配
- 风险等级评估
- 法规依据关联

#### 2.2.2 敏感信息检测模块
- 医生姓名检测（3种模式）
  - 姓名在前，职位在后：`王建国医生`
  - 职位在前，姓名在后：`医生王建国`
  - 姓氏+职位：`李主任`
- 脱敏规则：`王建国` → `王**`

#### 2.2.3 转换引擎模块
- 直接替换模式：自动替换为合规话术
- 高亮风险模式：标记风险点
- 仅提供建议模式：不修改原文

#### 2.2.4 LLM 智能分析模块（规划中）
- 语义分析：理解上下文语境
- 模糊判断：识别隐含风险表达
- 智能生成：基于语境生成合规话术

---

## 3. LLM 分层路由策略

### 3.1 模型选型

| 模型 | 用途 | 成本 | 优势 |
|------|------|------|------|
| Claude Opus 4.5 | 核心转换、复杂语义分析 | 高 | 最强理解能力 |
| Claude Sonnet 4.5 | 常规检测、中等复杂度 | 中 | 性价比高 |
| Gemini 2.5 Pro | 文档批量扫描 | 低 | 长文本处理 |

### 3.2 路由规则

```
输入文本
    │
    ├─ 简单关键词匹配 → 规则引擎（无需LLM）
    │
    ├─ 中等复杂度 → Claude Sonnet 4.5
    │
    ├─ 高复杂度/歧义 → Claude Opus 4.5
    │
    └─ 批量文档 → Gemini 2.5 Pro
```

---

## 4. 术语库数据结构

### 4.1 术语分类

| 风险类型 | 术语数量 | 示例 |
|----------|----------|------|
| 销售行为 | 15+ | 统方费、带金销售、处方提成 |
| 费用管理 | 10+ | 虚开发票、账外支付 |
| 客户管理 | 8+ | VIP医生维护 |
| 推广策略 | 12+ | 宴请、礼品、旅游 |
| 研发合作 | 6+ | 临床试验贿赂 |
| 患者项目 | 5+ | 回扣诱导 |
| 市场准入 | 5+ | 招标贿赂 |
| 数字化营销 | 5+ | 数据违规 |

### 4.2 术语数据结构

```json
{
  "id": "T001",
  "risk_type": "销售行为",
  "forbidden_term": "统方费",
  "synonyms": "处方数据费/开药数据费",
  "compliant_term": "处方数据合规分析服务费",
  "usage_example": "不得支付统方费获取医生处方数据",
  "legal_basis": "《反不正当竞争法》第7条",
  "penalty_case": "某药企支付统方费被罚3000万元",
  "compliance_points": "严禁以任何形式获取或支付非正常的处方数据费用",
  "risk_level": "高"
}
```

---

## 5. API 接口设计

### 5.1 核心接口

| 方法 | 路径 | 描述 |
|------|------|------|
| POST | /api/v1/convert | 文本转换 |
| POST | /api/v1/check | 风险检查（不替换）|
| POST | /api/v1/scan | 批量文档扫描 |
| GET | /api/v1/terms | 获取所有术语 |
| GET | /api/v1/terms/{keyword} | 查询单个术语 |
| GET | /api/v1/terms/types | 获取风险类型列表 |

### 5.2 响应格式

```json
{
  "original_text": "请王建国医生参加学术会议",
  "converted_text": "请王**参加学术会议",
  "risk_level": "低",
  "detection_count": 0,
  "detections": [],
  "suggestions": [],
  "legal_basis": [],
  "sensitive_data": [
    {
      "name": "王建国",
      "position": "医生",
      "start_pos": 1,
      "end_pos": 6,
      "original": "王建国医生",
      "masked": "王**"
    }
  ]
}
```

---

## 6. 部署方案

### 6.1 云平台架构（AWS）

```
┌─────────────────────────────────────────────────┐
│                  CloudFront / ALB               │
└────────────────────┬────────────────────────────┘
                     │
         ┌───────────┴───────────┐
         │                       │
┌────────▼────────┐    ┌────────▼────────┐
│   ECS/Fargate   │    │   Lambda        │
│   (API 服务)     │    │   (异步任务)     │
└────────┬────────┘    └─────────────────┘
         │
    ┌────┴────┬─────────┬──────────┐
    │         │         │          │
┌───▼───┐ ┌──▼───┐ ┌───▼───┐  ┌───▼────┐
│ RDS   │ │Redis │ │S3     │  │Pinecone│
│(PG)   │ │      │ │(存储)  │  │(向量)  │
└───────┘ └──────┘ └───────┘  └────────┘
```

### 6.2 阿里云方案

| 服务 | 用途 |
|------|------|
| ECS / ACK | API 服务部署 |
| RDS MySQL | 数据存储 |
| Redis | 缓存 |
| OSS | 文件存储 |
| FC (函数计算) | 异步任务处理 |

---

## 7. 开发路线图

### 7.1 已完成 (MVP)

- [x] 核心检测引擎
- [x] 术语库数据（66条）
- [x] 敏感信息检测与脱敏
- [x] FastAPI 服务
- [x] Web 前端界面

### 7.2 进行中

- [ ] 按钮点击问题修复
- [ ] 前端交互优化

### 7.3 规划中

- [ ] LLM 智能分析接入
- [ ] 企业微信/钉钉机器人
- [ ] 浏览器插件
- [ ] 文档批量扫描
- [ ] 用户反馈与术语库更新

---

## 8. 项目结构

```
compliance-agent/
├── backend/
│   ├── api/
│   │   └── main.py              # FastAPI 服务
│   ├── core/
│   │   └── detector.py          # 核心检测逻辑
│   ├── llm/
│   │   ├── router.py            # LLM 路由（规划中）
│   │   └── prompts.py           # 提示词模板（规划中）
│   ├── data/
│   │   └── terms.json           # 术语库数据
│   └── requirements.txt
├── frontend/
│   └── index.html               # Web 界面
├── docs/
│   └── design-spec.md           # 设计方案（本文档）
├── plugins/
│   └── browser-extension/       # 浏览器插件（规划中）
├── bots/
│   ├── wechat/                  # 企业微信机器人（规划中）
│   └── dingtalk/                # 钉钉机器人（规划中）
└── README.md
```

---

## 9. 风险等级说明

| 等级 | 图标 | 说明 | 示例术语 |
|------|------|------|----------|
| 高风险 | 🔴 | 可能触犯刑法 | 统方费、带金销售、处方提成 |
| 中风险 | 🟡 | 行政处罚风险 | VIP医生维护、宴请、礼品 |
| 低风险 | 🟢 | 表述不当 | 上量、抢占市场份额 |

---

## 10. 附录

### 10.1 数据来源
本系统基于《医疗终端事业部营销合规术语库》

### 10.2 相关法律法规
- 《中华人民共和国反不正当竞争法》
- 《中华人民共和国药品管理法》
- 《关于禁止商业贿赂行为的暂行规定》

### 10.3 技术支持
- 版本：v1.0.0
- API 文档：http://localhost:8000/docs
- 健康检查：http://localhost:8000/health
